{% extends "govuk_template.html" %}
{% block content %}
<div class="govuk-width-container" id="app">
  <main class="govuk-main-wrapper " id="main-content" role="main">

      <div class="govuk-tabs" data-module="tabs">
          <h1 class="govuk-tabs__title">
            Statistics
          </h1>
          <ul class="govuk-tabs__list">
            <li class="govuk-tabs__list-item">
              <a class="govuk-tabs__tab govuk-tabs__tab--selected" href="#current">
                Current
              </a>
            </li>
            <li class="govuk-tabs__list-item">
              <a class="govuk-tabs__tab" href="#daily">
                Daily
              </a>
            </li>
            <li class="govuk-tabs__list-item">
              <a class="govuk-tabs__tab" href="#monthly">
                Monthly
              </a>
            </li>
          </ul>

          <section class="govuk-tabs__panel" id="current">
            <h2 class="govuk-heading-m">Current</h2>
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-one-half">
                    <div class="chart-wrapper"
                         type="bar"
                         series="rows"
                         x-axis="x"
                         y-axis="y"
                         above="false"
                         ismultiple="false"
                         palette='["#b1d581","#b10e1e"]'
                    >
                        <table class="govuk-table">
                            <caption class="govuk-table__caption">Average failed resources</caption>
                            <thead class="govuk-table__head">
                                <tr class="govuk-table__row">
                                    <th class="govuk-table__header">
                                        Status
                                    </th>
                                    <th class="govuk-table__header govuk-table__header--numeric">
                                        Percent
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="govuk-table__body">
                                {% set summary = current.summary[0] %}
                                <tr class="govuk-table__row">
                                    <th class="govuk-table__header">
                                        Pass
                                    </th>
                                    <td class="govuk-table__cell govuk-table__cell--numeric">
                                        {{ ((1-summary.avg_percent_fails_per_account) * 100) | round(1, 'floor') }}
                                    </td>
                                </tr>
                                <tr class="govuk-table__row">
                                    <th class="govuk-table__header">
                                        Fail
                                    </th>
                                    <td class="govuk-table__cell govuk-table__cell--numeric">
                                        {{ (summary.avg_percent_fails_per_account * 100) | round(1, 'ceil') }}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="govuk-grid-column-one-half">
                    <div class="chart-wrapper"
                         type="bar"
                         series="rows"
                         x-axis="x"
                         y-axis="y"
                         above="false"
                         ismultiple="false"
                         palette='["#b1d581","#b10e1e"]'
                    >
                        <table class="govuk-table">
                            <caption class="govuk-table__caption">Accounts audited</caption>
                            <thead class="govuk-table__head">
                                <tr class="govuk-table__row">
                                    <th class="govuk-table__header">Status</th>
                                    <th class="govuk-table__header govuk-table__header--numeric">Percent</th>
                                </tr>
                            </thead>
                            <tbody class="govuk-table__body">
                                {% set summary = current.summary[0] %}
                                <tr class="govuk-table__row">
                                    <th class="govuk-table__header">Audited</th>
                                    <td class="govuk-table__cell govuk-table__cell--numeric">
                                        {{ (summary.percent_accounts_audited * 100) | round(1, 'floor') }}
                                    </td>
                                </tr>
                                <tr class="govuk-table__row">
                                    <th class="govuk-table__header">Not audited</th>
                                    <td class="govuk-table__cell govuk-table__cell--numeric">
                                        {{ ((1-summary.percent_accounts_audited) * 100) | round(1, 'ceil') }}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-full">
                    <div class="chart-wrapper"
                         type="bar"
                         series="cols"
                         x-axis="Account"
                         y-axis="Failure rate"
                         above="false"
                         ismultiple="false"
                         rotated="true"
                    >
                        <table class="govuk-table">
                            <caption class="govuk-table__caption">Account summary</caption>
                            <thead class="govuk-table__head">
                                <tr class="govuk-table__row">
                                    <th class="govuk-table__header">Account</th>
                                    <th class="govuk-table__header govuk-table__header--numeric">Percent failed</th>
                                </tr>
                            </thead>
                            <tbody class="govuk-table__body">
                                {% for account in current.account %}
                                <tr class="govuk-table__row">
                                    <th class="govuk-table__header">
                                        {{ account.account_id.account_id }}
                                        ({{ account.account_id.product_team_id.team_name }}:
                                         {{ account.account_id.account_name }})
                                    </th>
                                    <td class="govuk-table__cell govuk-table__cell--numeric">
                                        {{ (account.ratio * 100) | round(1) }}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
          </section>
          <section class="govuk-tabs__panel" id="daily">
            <h2 class="govuk-heading-m">Daily</h2>

          </section>
          <section class="govuk-tabs__panel" id="monthly">
            <h2 class="govuk-heading-m">Monthly</h2>

          </section>
      </div>
  </main>
</div>
{% endblock %}